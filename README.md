# BareUI Framework

Лёгкий, модульный UI-движок на **C99** для 320×240 экранов с возможностью портовки на *ESP32/FreeRTOS*. Все графические данные пишутся в RGB565-фреймбуфер, а HAL-интерфейс изолирует остальной код от железа.

- `include/ui_primitives.h` и `src/ui_primitives.c` — потокобезопасный контекст, framebuffer, очереди событий (сенсор, клавиатура), рисование прямоугольников и текст через шрифт BareUI, API управления шрифтами и событиями.
- `include/ui_widget.h` и `src/ui_widget.c` — начальная абстракция виджетов/контейнеров: иерархия, bounds, отрисовка и маршрутизация событий поверх примитивов, а также гибкий `ui_style_t` для настройки цветов, отступов, теней и дополнительных свойств.
- `include/ui_scene.h` и `src/ui_scene.c` — менеджер сцены, который содержит HAL/фреймбуфер, владеет корнем виджетов, маршалит события, вызывает пользовательские tick-хуки и управляет главным циклом. `include/ui_core.h` теперь включает этот слой как публичный вход в стек.
- `include/ui_font.h` + `src/ui_font.c` — шаблонный растровый шрифт, поддерживающий ASCII и кириллицу, механизмы поиска глифа и выставления интервала.
- `src/font/bareui_font_data.h` — данные шрифта, генерируемые из векторного TTF с помощью `tools/build_font.py`.
- `include/ui_hal_test.h` + `src/hal/hal_test_sdl.c` — десктопный HAL с 4× масштабированием framebuffer-а и эмуляцией тачскрина/клавиатуры через SDL2.
- `tests/main.c` — демонстрация BareUI, реагирующая на клики и клавиши.

## Шрифтовая цепочка
1. Откройте `tools/build_font.py`, укажите нужный TTF (`FONT_PATH`) и запустите `python tools/build_font.py > src/font/bareui_font_data.h` (нужен Python3 и библиотека Pillow).
2. Векторный файл содержимого генерирует колонны 8×8 для каждого символа, включая `Ё/ё` и `А-Я/а-я`. Не забудьте перегенерировать шрифт после замены TTF или добавления символов.
3. Рендер текста декодирует UTF‑8 и использует текущий `bareui_font_t`. Расстояние между символами задаётся `BAREUI_FONT_SPACING` (по умолчанию 1 колонка) — увеличьте до 2, если на вашей матрице «слипается».

## Тестирование на компьютере
Нужен SDL2 (`libsdl2-dev` на Debian/Ubuntu). Затем:
```bash
make
./tests/main
```
Окно 1280×960 (масштаб 4×) показывает framebuffer 320×240, мышь эмулирует сенсор, `q` закрывает. Русский текст демонстрирует поддержку кириллицы.
